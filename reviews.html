<body>
  <h1>Book Reviews</h1>
  <div id="reviews-container" style="padding: 20px;">
    <!-- Reviews will be dynamically added here -->
  </div>
  <div id="add-review" style="margin-top: 20px;">
    <h3>Add a Review</h3>
    <input type="text" id="reviewer" placeholder="Your Name" style="margin-bottom: 10px; width: 100%; padding: 8px;" />
    <textarea id="comment" placeholder="Your Comment" style="margin-bottom: 10px; width: 100%; padding: 8px;"></textarea>
    <label for="rating">Rating:</label>
    <select id="rating" style="margin-bottom: 10px; width: 100%; padding: 8px;">
      <option value="1">1 Star</option>
      <option value="2">2 Stars</option>
      <option value="3">3 Stars</option>
      <option value="4">4 Stars</option>
      <option value="5">5 Stars</option>
    </select>
    <button onclick="addReview()" style="padding: 10px 20px; background-color: #007bff; color: white; border: none; border-radius: 4px; cursor: pointer;">Submit</button>
  </div>
  <script>
    const urlParams = new URLSearchParams(window.location.search);
    const bookId = urlParams.get("bookId");

    async function loadReviews() {
      try {
        const response = await fetch(`http://localhost:3000/reviews/${bookId}`);
        const reviews = await response.json();

        const container = document.getElementById("reviews-container");
        container.innerHTML = "";
        reviews.forEach(review => {
          const reviewDiv = document.createElement("div");
          reviewDiv.style.border = "1px solid #ccc";
          reviewDiv.style.borderRadius = "8px";
          reviewDiv.style.padding = "10px";
          reviewDiv.style.marginBottom = "10px";

          const reviewerName = document.createElement("h4");
          reviewerName.textContent = review.reviewer;

          const rating = document.createElement("p");
          rating.textContent = `Rating: ${review.rating} Stars`;

          const comment = document.createElement("p");
          comment.textContent = review.comment;

          reviewDiv.appendChild(reviewerName);
          reviewDiv.appendChild(rating);
          reviewDiv.appendChild(comment);

          container.appendChild(reviewDiv);
        });
      } catch (error) {
        console.error("Error loading reviews:", error);
      }
    }

    async function addReview() {
      const reviewer = document.getElementById("reviewer").value;
      const comment = document.getElementById("comment").value;
      const rating = document.getElementById("rating").value;

      if (!reviewer || !comment || !rating) {
        alert("Please fill in all fields.");
        return;
      }

      try {
        await fetch("http://localhost:3000/reviews", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ bookId, reviewer, rating, comment })
        });

        document.getElementById("reviewer").value = "";
        document.getElementById("comment").value = "";
        document.getElementById("rating").value = "1";

        loadReviews();
      } catch (error) {
        console.error("Error adding review:", error);
      }
    }

    loadReviews();
  </script>
</body>
